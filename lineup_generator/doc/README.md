# Report
## How Lineup Generator works

Lineup Generator goal is to choose a subset of nine players in a set of players in order to respect some constraints and guarantee the best combination according some criteria. Because we are interested in finding the best solution from all feasible solutions, a natural way of looking to this problem is as an [optimization problem][optimization]. So it is possible to write the problem as a mathematical model and try to solve it using [mathematical integer program][ip] and very well consolidated tools/algorithms for optimization.

Before presenting the model, let's introduce some notation.
Consider <img src="http://mathurl.com/25htm3r.png" alt="A"> the set of players, <img src="http://mathurl.com/3aj257d.png" alt="T"> the set of teams and <img src="http://mathurl.com/22kf4dt.png" alt="P"> the set of possible positions a player can assume. Each player <img src="http://mathurl.com/5ldlsl.png" alt="i"> has some caracteristics like team, position, salary, ownership, score and so on.

Let's associate for each player <img src="http://mathurl.com/gsbq25f.png" alt="i_in_A"> a binary variable <img src="http://mathurl.com/2az2c7m.png" alt="x_i">, that assumes value 1 if player <img src="http://mathurl.com/5ldlsl.png" alt="i"> is choose for the lineup and 0, otherwise.
Let's also associate for each team <img src="http://mathurl.com/hr89jym.png" alt="j_in_T"> a binary variable <img src="http://mathurl.com/oujkp62.png" alt="z_j">, that assumes value 1 if at least one player <img src="http://mathurl.com/5ldlsl.png" alt="i"> of team <img src="http://mathurl.com/6u2lg2j.png" alt="j"> is choose for the lineup and 0, otherwise. This is a very important variable to impose some mandatory constraints to the problem.
Let's define <img src="http://mathurl.com/zv4xfq9.png" alt="L_k_in_Z"> the necessary number of players for position <img src="http://mathurl.com/zdzqyah.png" alt="k_in_P"> in a valid lineup.

The criteria used to evaluate the lineup is the player scores, so the objective function is to maximize the score sum for the nine selected players. The mathematical model that aims to find the best lineup possible is as following.

<img src="http://mathurl.com/gq4rsjf.png" alt="objective"> (0)

subject to

<img src="http://mathurl.com/jlp6zpl.png" alt="constraints">













[ip]: https://en.wikipedia.org/wiki/Integer_programming "Integer Programming"
[optimization]: https://en.wikipedia.org/wiki/Optimization_problem "Optimization Problem"












###Install dependencies
Lineup generator depends on

1. [Google Optimization Tools (or-tools)][ortools]: Google software suite for combinatorial optimization, that provides a C++ API to implement and solve mathematical models through [CBC][cbc]. This code uses the [binary distribution][ubuntu] for Ubuntu 14.04.
2. [libpqxx4-0][pqxx]: the official C++ client API for â€‹PostgreSQL. It can be installed through apt-get. You need both libpqxx-4.0 and libpqxx-dev installed.
3. [PostgreSQL][postgresql]: database (version 9.4). For instructions on how to install in linux mint through apt-get see [Installing and Configuring Postgresql on Linux Mint][mint].
4. GCC compiler version 4.9.

In order to compile and run Lineup Generator successfully, make sure you have all the tools above installed.

### Create database

You can find into the `database` directory a .sql file to create database and its tables, and also a simple program to populate it from a .json file. The executable file can be generated by running `make` from the database directory. If everything goes fine then you can run:
```
$ ./populate_db
```
###Download and compile
We assume you have a directory with or-tools already installed and working.

1. After you have installed and tested all dependencies, download and copy this inner `lineup_generator` directory and `Makefile.user` file in the top level of your or-tools directory.
2. Run the following command from the top level of or-tools directory:

	``` $ make ccc EX=lineup_generator/src/lineup_generator.cc```

3. You should have a `bin/lineup_generator` binary if compilation is successfully. Finally run lineup generator and if you get an error of missing arguments everything is working.

	```$ ./bin/lineup_generator```

### Run
The command to run the tool is:
```
./bin/lineup_generator [-num_lineups n] -dbname <db_name> -user <db_user> -password <db_password> [-host db_address] [-port db_port]
```
If no *n* for *-num_lineups* is given, then just one lineup is provided.

[mint]:https://www.codeproject.com/articles/898303/installing-and-configuring-postgresql-on-linux-min. "installing-and-configuring-postgresql"
[postgresql]: https://www.postgresql.org/ "PostgreSQL"
[ubuntu]: https://github.com/google/or-tools/releases/download/v5.0/or-tools_Ubuntu-14.04-64bit_v5.0.3919.tar.gz "Ubuntu 14.04"
[cbc]: https://projects.coin-or.org/Cbc "CBC"
[pqxx]: http://pqxx.org/development/libpqxx/ "libpqxx"
[ortools]: https://developers.google.com/optimization/        "Google Optimization Tools"
